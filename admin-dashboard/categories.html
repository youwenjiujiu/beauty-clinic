<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åˆ†ç±»ç®¡ç† - ç®¡ç†åå°</title>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background-color: #f0f2f5;
      font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .header h1 {
      margin: 0;
      font-size: 28px;
    }
    .header p {
      margin: 10px 0 0 0;
      opacity: 0.9;
    }
    .categories-panel {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
    }
    .category-item {
      padding: 15px;
      margin: 10px 0;
      background: #f5f7fa;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: move;
      transition: all 0.3s;
    }
    .category-item:hover {
      background: #e6f2ff;
      transform: translateX(5px);
    }
    .category-item.sortable-ghost {
      opacity: 0.4;
      background: #c0c4cc;
    }
    .category-icon {
      font-size: 24px;
      width: 40px;
      text-align: center;
    }
    .category-info {
      flex: 1;
    }
    .category-name {
      font-size: 16px;
      font-weight: 500;
      color: #303133;
    }
    .category-id {
      font-size: 12px;
      color: #909399;
      margin-top: 5px;
    }
    .category-type {
      padding: 3px 10px;
      border-radius: 4px;
      font-size: 12px;
    }
    .type-home {
      background: #e6f7ff;
      color: #1890ff;
    }
    .type-filter {
      background: #fff7e6;
      color: #fa8c16;
    }
    .type-both {
      background: #f6ffed;
      color: #52c41a;
    }
    .actions-section {
      margin-top: 30px;
      display: flex;
      gap: 15px;
    }
    .drag-handle {
      color: #909399;
      cursor: move;
    }
    .save-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #52c41a;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
      z-index: 9999;
    }
    .category-actions {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="header">
      <h1>ğŸ·ï¸ åˆ†ç±»ç®¡ç†</h1>
      <p>ç®¡ç†å°ç¨‹åºçš„æœåŠ¡åˆ†ç±»å’Œç­›é€‰åˆ†ç±»</p>
    </div>

    <div class="categories-panel">
      <el-alert
        title="æ‹–æ‹½åˆ†ç±»å¯ä»¥è°ƒæ•´æ˜¾ç¤ºé¡ºåº"
        type="info"
        show-icon
        :closable="false"
        style="margin-bottom: 20px">
      </el-alert>

      <!-- åˆ†ç±»åˆ—è¡¨ -->
      <div id="categoryList">
        <div v-for="(category, index) in categories" :key="category.id"
          class="category-item" :data-id="category.id">
          <div class="drag-handle">â˜°</div>
          <div class="category-icon">{{ category.icon || 'ğŸ“¦' }}</div>
          <div class="category-info">
            <div class="category-name">{{ category.name }}</div>
            <div class="category-id">ID: {{ category.id }}</div>
          </div>
          <div class="category-type" :class="'type-' + category.type">
            {{ getTypeLabel(category.type) }}
          </div>
          <div class="category-actions">
            <el-button size="small" @click="editCategory(category)">ç¼–è¾‘</el-button>
            <el-button size="small" type="danger" @click="deleteCategory(index)">åˆ é™¤</el-button>
          </div>
        </div>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="actions-section">
        <el-button type="primary" @click="addCategory">+ æ·»åŠ åˆ†ç±»</el-button>
        <el-button type="success" @click="saveCategories">ä¿å­˜åˆ°æœåŠ¡å™¨</el-button>
        <el-button @click="resetCategories">é‡ç½®ä¸ºé»˜è®¤</el-button>
      </div>
    </div>

    <!-- ç¼–è¾‘å¯¹è¯æ¡† -->
    <el-dialog :title="editMode === 'add' ? 'æ·»åŠ åˆ†ç±»' : 'ç¼–è¾‘åˆ†ç±»'"
      :visible.sync="dialogVisible" width="500px">
      <el-form :model="currentCategory" label-width="100px">
        <el-form-item label="åˆ†ç±»ID">
          <el-input v-model="currentCategory.id" placeholder="ä¾‹å¦‚: skin"
            :disabled="editMode === 'edit'"></el-input>
        </el-form-item>
        <el-form-item label="åˆ†ç±»åç§°">
          <el-input v-model="currentCategory.name" placeholder="ä¾‹å¦‚: çš®è‚¤ç®¡ç†"></el-input>
        </el-form-item>
        <el-form-item label="å›¾æ ‡">
          <el-input v-model="currentCategory.icon" placeholder="ä¾‹å¦‚: ğŸ§´">
            <template slot="append">
              <el-dropdown @command="selectIcon">
                <el-button>é€‰æ‹©å›¾æ ‡</el-button>
                <el-dropdown-menu slot="dropdown">
                  <el-dropdown-item command="ğŸ§´">ğŸ§´ æŠ¤è‚¤</el-dropdown-item>
                  <el-dropdown-item command="ğŸ’‰">ğŸ’‰ æ³¨å°„</el-dropdown-item>
                  <el-dropdown-item command="ğŸ’Š">ğŸ’Š è¯ç‰©</el-dropdown-item>
                  <el-dropdown-item command="âœ¨">âœ¨ æ¿€å…‰</el-dropdown-item>
                  <el-dropdown-item command="ğŸ’ª">ğŸ’ª å¡‘å½¢</el-dropdown-item>
                  <el-dropdown-item command="ğŸŒŸ">ğŸŒŸ æŠ—è¡°</el-dropdown-item>
                  <el-dropdown-item command="ğŸ¥">ğŸ¥ åŒ»é™¢</el-dropdown-item>
                  <el-dropdown-item command="ğŸ‘¨â€âš•ï¸">ğŸ‘¨â€âš•ï¸ åŒ»ç”Ÿ</el-dropdown-item>
                </el-dropdown-menu>
              </el-dropdown>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="æ˜¾ç¤ºä½ç½®">
          <el-select v-model="currentCategory.type" placeholder="è¯·é€‰æ‹©">
            <el-option label="ä»…ä¸»é¡µå›¾æ ‡" value="home"></el-option>
            <el-option label="ä»…ç­›é€‰åˆ†ç±»" value="filter"></el-option>
            <el-option label="ä¸¤å¤„éƒ½æ˜¾ç¤º" value="both"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="æ’åºæƒé‡">
          <el-input-number v-model="currentCategory.order" :min="1" :max="100"></el-input-number>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="dialogVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="confirmEdit">ç¡®å®š</el-button>
      </span>
    </el-dialog>

    <!-- ä¿å­˜æŒ‡ç¤ºå™¨ -->
    <div class="save-indicator" id="saveIndicator">âœ… å·²ä¿å­˜åˆ°æœåŠ¡å™¨</div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        categories: [],
        dialogVisible: false,
        editMode: 'add',
        currentCategory: {
          id: '',
          name: '',
          icon: '',
          type: 'both',
          order: 1
        },
        editIndex: -1,
        apiUrl: 'https://beauty-clinic-backend-anvh7eios-youwenjiujius-projects.vercel.app'
      },
      mounted() {
        this.loadCategories();
        this.initSortable();
      },
      methods: {
        // åŠ è½½åˆ†ç±»
        async loadCategories() {
          try {
            const response = await axios.get(`${this.apiUrl}/api/config/categories`);
            if (response.data.success) {
              this.categories = response.data.data;
            }
          } catch (error) {
            console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
            this.$message.error('åŠ è½½åˆ†ç±»å¤±è´¥');
          }
        },

        // åˆå§‹åŒ–æ‹–æ‹½
        initSortable() {
          const el = document.getElementById('categoryList');
          Sortable.create(el, {
            animation: 150,
            handle: '.drag-handle',
            onEnd: (evt) => {
              const item = this.categories.splice(evt.oldIndex, 1)[0];
              this.categories.splice(evt.newIndex, 0, item);
              this.updateOrder();
            }
          });
        },

        // æ›´æ–°æ’åº
        updateOrder() {
          this.categories.forEach((cat, index) => {
            cat.order = index + 1;
          });
        },

        // æ·»åŠ åˆ†ç±»
        addCategory() {
          this.editMode = 'add';
          this.currentCategory = {
            id: '',
            name: '',
            icon: '',
            type: 'both',
            order: this.categories.length + 1
          };
          this.dialogVisible = true;
        },

        // ç¼–è¾‘åˆ†ç±»
        editCategory(category) {
          this.editMode = 'edit';
          this.currentCategory = { ...category };
          this.editIndex = this.categories.findIndex(c => c.id === category.id);
          this.dialogVisible = true;
        },

        // åˆ é™¤åˆ†ç±»
        deleteCategory(index) {
          this.$confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»å—ï¼Ÿ', 'æç¤º', {
            confirmButtonText: 'ç¡®å®š',
            cancelButtonText: 'å–æ¶ˆ',
            type: 'warning'
          }).then(() => {
            this.categories.splice(index, 1);
            this.updateOrder();
            this.$message.success('åˆ é™¤æˆåŠŸ');
          }).catch(() => {});
        },

        // ç¡®è®¤ç¼–è¾‘
        confirmEdit() {
          if (!this.currentCategory.id || !this.currentCategory.name) {
            this.$message.warning('è¯·å¡«å†™å¿…è¦ä¿¡æ¯');
            return;
          }

          if (this.editMode === 'add') {
            // æ£€æŸ¥IDæ˜¯å¦é‡å¤
            if (this.categories.some(c => c.id === this.currentCategory.id)) {
              this.$message.warning('åˆ†ç±»IDå·²å­˜åœ¨');
              return;
            }
            this.categories.push({ ...this.currentCategory });
          } else {
            this.categories.splice(this.editIndex, 1, { ...this.currentCategory });
          }

          this.dialogVisible = false;
          this.$message.success('æ“ä½œæˆåŠŸ');
        },

        // é€‰æ‹©å›¾æ ‡
        selectIcon(icon) {
          this.currentCategory.icon = icon;
        },

        // è·å–ç±»å‹æ ‡ç­¾
        getTypeLabel(type) {
          const labels = {
            home: 'ä¸»é¡µå›¾æ ‡',
            filter: 'ç­›é€‰åˆ†ç±»',
            both: 'ä¸¤å¤„éƒ½æ˜¾'
          };
          return labels[type] || type;
        },

        // ä¿å­˜åˆ°æœåŠ¡å™¨
        async saveCategories() {
          try {
            const response = await axios.post(`${this.apiUrl}/api/config/categories`, {
              categories: this.categories
            });

            if (response.data.success) {
              this.$message.success('ä¿å­˜æˆåŠŸ');
              // æ˜¾ç¤ºä¿å­˜æŒ‡ç¤ºå™¨
              const indicator = document.getElementById('saveIndicator');
              indicator.style.display = 'block';
              setTimeout(() => {
                indicator.style.display = 'none';
              }, 3000);
            }
          } catch (error) {
            console.error('ä¿å­˜å¤±è´¥:', error);
            this.$message.error('ä¿å­˜å¤±è´¥');
          }
        },

        // é‡ç½®ä¸ºé»˜è®¤
        resetCategories() {
          this.$confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤åˆ†ç±»å—ï¼Ÿ', 'æç¤º', {
            confirmButtonText: 'ç¡®å®š',
            cancelButtonText: 'å–æ¶ˆ',
            type: 'warning'
          }).then(() => {
            this.categories = [
              { id: 'skin', name: 'çš®è‚¤ç®¡ç†', icon: 'ğŸ§´', order: 1, type: 'both' },
              { id: 'plastic', name: 'æ•´å½¢æ‰‹æœ¯', icon: 'ğŸ’‰', order: 2, type: 'both' },
              { id: 'injection', name: 'å¾®æ•´å½¢', icon: 'ğŸ’Š', order: 3, type: 'both' },
              { id: 'laser', name: 'æ¿€å…‰æå‡', icon: 'âœ¨', order: 4, type: 'both' },
              { id: 'body', name: 'èº«ä½“å¡‘å½¢', icon: 'ğŸ’ª', order: 5, type: 'filter' },
              { id: 'antiaging', name: 'æŠ—è¡°è€', icon: 'ğŸŒŸ', order: 6, type: 'filter' }
            ];
            this.$message.success('å·²é‡ç½®ä¸ºé»˜è®¤åˆ†ç±»');
          }).catch(() => {});
        }
      }
    });
  </script>
</body>
</html>