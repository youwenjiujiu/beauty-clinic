<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é™ªåŒé¡¾é—®ç®¡ç† - ç®¡ç†åå°</title>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background-color: #f0f2f5;
      font-family: "Helvetica Neue", Helvetica, "PingFang SC", Arial, sans-serif;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .header h1 {
      margin: 0;
      font-size: 28px;
    }
    .header p {
      margin: 10px 0 0 0;
      opacity: 0.9;
    }
    .content-wrapper {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 20px;
    }
    .advisor-list-panel {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
    }
    .schedule-panel {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);
      height: fit-content;
    }
    .advisor-card {
      border: 1px solid #e4e7ed;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    .advisor-card:hover {
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
    }
    .advisor-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }
    .advisor-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }
    .advisor-info {
      flex: 1;
    }
    .advisor-name {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 5px;
    }
    .advisor-title {
      color: #909399;
      font-size: 14px;
    }
    .advisor-stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #f0f0f0;
    }
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stat-value {
      font-size: 20px;
      font-weight: bold;
      color: #409eff;
    }
    .stat-label {
      font-size: 12px;
      color: #909399;
      margin-top: 3px;
    }
    .schedule-table {
      margin-top: 20px;
    }
    .schedule-day {
      margin-bottom: 15px;
    }
    .schedule-day-title {
      font-weight: 500;
      margin-bottom: 8px;
      color: #303133;
    }
    .time-slots {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    .time-slot {
      padding: 8px;
      text-align: center;
      border: 1px solid #dcdfe6;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 13px;
    }
    .time-slot.available {
      background: #f0f9ff;
      border-color: #409eff;
      color: #409eff;
    }
    .time-slot.unavailable {
      background: #f5f5f5;
      color: #c0c4cc;
      cursor: not-allowed;
    }
    .advisor-tags {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .internal-badge {
      background: #fef0f0;
      color: #f56c6c;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
    }
    .add-advisor-btn {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="header">
      <h1>ğŸ‘¥ é™ªåŒé¡¾é—®ç®¡ç†</h1>
      <p>ç®¡ç†åŒ»ç–—é™ªåŒé¡¾é—®ä¿¡æ¯å’Œæ’ç­</p>
    </div>

    <div class="content-wrapper">
      <!-- é¡¾é—®åˆ—è¡¨ -->
      <div class="advisor-list-panel">
        <el-button type="primary" @click="showAddDialog" class="add-advisor-btn">
          + æ·»åŠ é¡¾é—®
        </el-button>

        <div v-for="advisor in advisors" :key="advisor.id" class="advisor-card">
          <div class="advisor-header">
            <div class="advisor-avatar">
              {{ advisor.name.charAt(0) }}
            </div>
            <div class="advisor-info">
              <div class="advisor-name">
                {{ advisor.name }}
                <el-tag size="mini" v-if="advisor.status === 'inactive'" type="danger">å·²åœç”¨</el-tag>
              </div>
              <div class="advisor-title">{{ advisor.title }}</div>
            </div>
            <div class="advisor-actions">
              <el-button size="small" @click="editAdvisor(advisor)">ç¼–è¾‘</el-button>
              <el-button size="small" @click="manageSchedule(advisor)">æ’ç­</el-button>
              <el-button size="small" type="danger" @click="deleteAdvisor(advisor)">åˆ é™¤</el-button>
            </div>
          </div>

          <div class="advisor-stats">
            <div class="stat-item">
              <div class="stat-value">{{ advisor.rating || 5.0 }}</div>
              <div class="stat-label">è¯„åˆ†</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ advisor.serviceCount || 0 }}</div>
              <div class="stat-label">æœåŠ¡æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ advisor.experience }}</div>
              <div class="stat-label">ç»éªŒ</div>
            </div>
          </div>

          <div class="advisor-tags">
            <el-tag size="mini" v-for="tag in advisor.tags" :key="tag">{{ tag }}</el-tag>
            <!-- å†…éƒ¨æ ‡è®°ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰ -->
            <span class="internal-badge" v-if="advisor.internal && advisor.internal.type === 'senior'">
              èµ„æ·±ï¼ˆä¸­éŸ©ï¼‰
            </span>
          </div>
        </div>
      </div>

      <!-- æ’ç­ç®¡ç†é¢æ¿ -->
      <div class="schedule-panel" v-if="currentScheduleAdvisor">
        <h3>æ’ç­ç®¡ç† - {{ currentScheduleAdvisor.name }}</h3>

        <el-date-picker
          v-model="scheduleDate"
          type="date"
          placeholder="é€‰æ‹©æ—¥æœŸ"
          @change="loadSchedule"
          style="width: 100%; margin-bottom: 20px">
        </el-date-picker>

        <div class="schedule-table">
          <div class="schedule-day">
            <div class="schedule-day-title">{{ formatDate(scheduleDate) }} æ’ç­</div>
            <div class="time-slots">
              <div v-for="slot in timeSlots" :key="slot.time"
                :class="['time-slot', slot.available ? 'available' : 'unavailable']"
                @click="toggleSlot(slot)">
                {{ slot.time }}
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: 20px;">
          <el-button type="primary" @click="saveSchedule" size="small">ä¿å­˜æ’ç­</el-button>
          <el-button @click="currentScheduleAdvisor = null" size="small">å…³é—­</el-button>
        </div>
      </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘é¡¾é—®å¯¹è¯æ¡† -->
    <el-dialog :title="editMode === 'add' ? 'æ·»åŠ é¡¾é—®' : 'ç¼–è¾‘é¡¾é—®'"
      :visible.sync="dialogVisible" width="600px">
      <el-form :model="currentAdvisor" label-width="100px">
        <el-form-item label="å§“å">
          <el-input v-model="currentAdvisor.name" placeholder="è¯·è¾“å…¥é¡¾é—®å§“å"></el-input>
        </el-form-item>
        <el-form-item label="èŒç§°">
          <el-select v-model="currentAdvisor.title" placeholder="è¯·é€‰æ‹©">
            <el-option label="èµ„æ·±åŒ»ç–—é¡¾é—®" value="èµ„æ·±åŒ»ç–—é¡¾é—®"></el-option>
            <el-option label="åŒ»ç–—é¡¾é—®" value="åŒ»ç–—é¡¾é—®"></el-option>
            <el-option label="åŒ»ç–—åŠ©ç†" value="åŒ»ç–—åŠ©ç†"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="ç»éªŒ">
          <el-input v-model="currentAdvisor.experience" placeholder="ä¾‹å¦‚ï¼š3å¹´"></el-input>
        </el-form-item>
        <el-form-item label="ä¸“é•¿">
          <el-input v-model="currentAdvisor.specialty" placeholder="ä¾‹å¦‚ï¼šæ•´å½¢å¤–ç§‘é™ªåŒ"></el-input>
        </el-form-item>
        <el-form-item label="æ ‡ç­¾">
          <el-select v-model="currentAdvisor.tags" multiple placeholder="è¯·é€‰æ‹©æ ‡ç­¾">
            <el-option label="ä¸“ä¸š" value="ä¸“ä¸š"></el-option>
            <el-option label="ç»†å¿ƒ" value="ç»†å¿ƒ"></el-option>
            <el-option label="ç»éªŒä¸°å¯Œ" value="ç»éªŒä¸°å¯Œ"></el-option>
            <el-option label="è€å¿ƒ" value="è€å¿ƒ"></el-option>
            <el-option label="è´Ÿè´£" value="è´Ÿè´£"></el-option>
            <el-option label="å‹å–„" value="å‹å–„"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="å†…éƒ¨å¤‡æ³¨">
          <el-input type="textarea" v-model="currentAdvisor.internalNote"
            placeholder="ä»…å†…éƒ¨å¯è§ï¼Œå¯ä»¥å¤‡æ³¨è¯­è¨€èƒ½åŠ›ç­‰ä¿¡æ¯"></el-input>
        </el-form-item>
        <el-form-item label="ç±»å‹">
          <el-radio-group v-model="currentAdvisor.type">
            <el-radio label="senior">èµ„æ·±é¡¾é—®ï¼ˆæ‡‚ä¸­éŸ©åŒè¯­ï¼‰</el-radio>
            <el-radio label="basic">æ ‡å‡†é¡¾é—®</el-radio>
          </el-radio-group>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="dialogVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="saveAdvisor">ç¡®å®š</el-button>
      </span>
    </el-dialog>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        advisors: [],
        dialogVisible: false,
        editMode: 'add',
        currentAdvisor: {
          name: '',
          title: 'åŒ»ç–—é¡¾é—®',
          experience: '',
          specialty: '',
          tags: [],
          type: 'senior',
          internalNote: ''
        },
        currentScheduleAdvisor: null,
        scheduleDate: new Date(),
        timeSlots: [],
        apiUrl: 'https://beauty-clinic-backend.vercel.app'
      },
      mounted() {
        this.loadAdvisors();
        this.initTimeSlots();
      },
      methods: {
        // åŠ è½½é¡¾é—®åˆ—è¡¨
        async loadAdvisors() {
          try {
            const response = await axios.get(`${this.apiUrl}/api/advisors/list`);
            if (response.data.success) {
              this.advisors = response.data.data;
            }
          } catch (error) {
            console.error('åŠ è½½é¡¾é—®åˆ—è¡¨å¤±è´¥:', error);
            this.$message.error('åŠ è½½é¡¾é—®åˆ—è¡¨å¤±è´¥');
          }
        },

        // åˆå§‹åŒ–æ—¶é—´æ®µ
        initTimeSlots() {
          const slots = [
            '09:00-11:00',
            '11:00-13:00',
            '14:00-16:00',
            '16:00-18:00',
            '18:00-20:00',
            '20:00-22:00'
          ];
          this.timeSlots = slots.map(time => ({
            time: time,
            available: true
          }));
        },

        // æ˜¾ç¤ºæ·»åŠ å¯¹è¯æ¡†
        showAddDialog() {
          this.editMode = 'add';
          this.currentAdvisor = {
            name: '',
            title: 'åŒ»ç–—é¡¾é—®',
            experience: '',
            specialty: '',
            tags: [],
            type: 'senior',
            internalNote: ''
          };
          this.dialogVisible = true;
        },

        // ç¼–è¾‘é¡¾é—®
        editAdvisor(advisor) {
          this.editMode = 'edit';
          this.currentAdvisor = { ...advisor };
          this.dialogVisible = true;
        },

        // ä¿å­˜é¡¾é—®
        async saveAdvisor() {
          try {
            if (this.editMode === 'add') {
              const response = await axios.post(`${this.apiUrl}/api/advisors/add`, {
                ...this.currentAdvisor,
                languages: this.currentAdvisor.type === 'senior' ? ['zh', 'kr'] : ['zh']
              });
              if (response.data.success) {
                this.$message.success('æ·»åŠ æˆåŠŸ');
                this.loadAdvisors();
              }
            } else {
              const response = await axios.put(
                `${this.apiUrl}/api/advisors/update/${this.currentAdvisor.id}`,
                this.currentAdvisor
              );
              if (response.data.success) {
                this.$message.success('æ›´æ–°æˆåŠŸ');
                this.loadAdvisors();
              }
            }
            this.dialogVisible = false;
          } catch (error) {
            console.error('ä¿å­˜å¤±è´¥:', error);
            this.$message.error('ä¿å­˜å¤±è´¥');
          }
        },

        // åˆ é™¤é¡¾é—®
        deleteAdvisor(advisor) {
          this.$confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¾é—®å—ï¼Ÿ', 'æç¤º', {
            confirmButtonText: 'ç¡®å®š',
            cancelButtonText: 'å–æ¶ˆ',
            type: 'warning'
          }).then(async () => {
            try {
              const response = await axios.delete(
                `${this.apiUrl}/api/advisors/delete/${advisor.id}`
              );
              if (response.data.success) {
                this.$message.success('åˆ é™¤æˆåŠŸ');
                this.loadAdvisors();
              }
            } catch (error) {
              console.error('åˆ é™¤å¤±è´¥:', error);
              this.$message.error('åˆ é™¤å¤±è´¥');
            }
          }).catch(() => {});
        },

        // ç®¡ç†æ’ç­
        manageSchedule(advisor) {
          this.currentScheduleAdvisor = advisor;
          this.loadSchedule();
        },

        // åŠ è½½æ’ç­
        async loadSchedule() {
          if (!this.currentScheduleAdvisor) return;

          try {
            const date = this.formatDateForApi(this.scheduleDate);
            const response = await axios.get(
              `${this.apiUrl}/api/advisors/schedule/${this.currentScheduleAdvisor.id}?date=${date}`
            );

            // æ›´æ–°æ—¶é—´æ®µçŠ¶æ€
            if (response.data.success && response.data.data.schedules[date]) {
              const schedule = response.data.data.schedules[date];
              this.timeSlots = this.timeSlots.map(slot => {
                const found = schedule.find(s => s.time === slot.time);
                return found || slot;
              });
            } else {
              this.initTimeSlots();
            }
          } catch (error) {
            console.error('åŠ è½½æ’ç­å¤±è´¥:', error);
          }
        },

        // åˆ‡æ¢æ—¶é—´æ®µçŠ¶æ€
        toggleSlot(slot) {
          slot.available = !slot.available;
        },

        // ä¿å­˜æ’ç­
        async saveSchedule() {
          try {
            const date = this.formatDateForApi(this.scheduleDate);
            const response = await axios.post(`${this.apiUrl}/api/advisors/schedule`, {
              advisorId: this.currentScheduleAdvisor.id,
              date: date,
              slots: this.timeSlots
            });

            if (response.data.success) {
              this.$message.success('æ’ç­ä¿å­˜æˆåŠŸ');
            }
          } catch (error) {
            console.error('ä¿å­˜æ’ç­å¤±è´¥:', error);
            this.$message.error('ä¿å­˜æ’ç­å¤±è´¥');
          }
        },

        // æ ¼å¼åŒ–æ—¥æœŸ
        formatDate(date) {
          const d = new Date(date);
          const weekDays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
          return `${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥ ${weekDays[d.getDay()]}`;
        },

        // æ ¼å¼åŒ–æ—¥æœŸç”¨äºAPI
        formatDateForApi(date) {
          const d = new Date(date);
          return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        }
      }
    });
  </script>
</body>
</html>