<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é™ªåŒé¡¾é—®ç®¡ç† - å˜Ÿå˜Ÿé¢„çº¦é€š</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div id="app">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-white shadow-lg mb-6">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <a href="index.html" class="text-blue-500 mr-4">â† è¿”å›</a>
            <h1 class="text-xl font-bold">é™ªåŒé¡¾é—®ç®¡ç†</h1>
          </div>
          <div class="flex items-center space-x-4">
            <button @click="loadConsultants" class="bg-blue-500 text-white px-4 py-2 rounded">åˆ·æ–°</button>
            <button @click="openAddDialog" class="bg-green-500 text-white px-4 py-2 rounded">æ·»åŠ é¡¾é—®</button>
          </div>
        </div>
      </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4">
      <!-- é¡¾é—®åˆ—è¡¨ -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div v-for="consultant in consultants" :key="consultant._id" class="bg-white rounded-lg shadow-lg p-6">
          <!-- å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
          <div class="flex items-start mb-4">
            <img v-if="consultant.avatar" :src="consultant.avatar" class="w-20 h-20 rounded-full object-cover mr-4" />
            <div v-else class="w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center mr-4">
              <span class="text-2xl">ğŸ‘¤</span>
            </div>
            <div class="flex-1">
              <div class="flex items-center mb-1">
                <h3 class="text-xl font-bold">{{ consultant.name }}</h3>
                <span v-if="consultant.nameKr" class="text-gray-500 ml-2">({{ consultant.nameKr }})</span>
              </div>
              <div class="flex items-center mb-2">
                <span class="text-yellow-500">â˜…</span>
                <span class="ml-1 font-semibold">{{ consultant.rating }}</span>
                <span class="text-gray-500 text-sm ml-2">({{ consultant.reviewCount || 0 }}æ¡è¯„ä»·)</span>
              </div>
              <div class="flex flex-wrap gap-1">
                <span v-for="tag in consultant.tags" :key="tag" class="bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded">
                  {{ tag }}
                </span>
                <span v-if="consultant.featured" class="bg-red-100 text-red-600 text-xs px-2 py-1 rounded">
                  æ¨è
                </span>
              </div>
            </div>
          </div>

          <!-- è¯¦ç»†ä¿¡æ¯ -->
          <div class="space-y-2 text-sm mb-4">
            <div class="flex">
              <span class="text-gray-600 w-20">æ€§åˆ«:</span>
              <span>{{ getGenderText(consultant.gender) }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">ç»éªŒ:</span>
              <span>{{ consultant.experience }}å¹´</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">è¯­è¨€:</span>
              <span>{{ (consultant.languages || []).join('ã€') }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">ä¸“é•¿:</span>
              <span>{{ (consultant.specialties || []).join('ã€') }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">æœåŠ¡åŒºåŸŸ:</span>
              <span>{{ (consultant.serviceAreas || []).join('ã€') }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">è”ç³»æ–¹å¼:</span>
              <span>{{ consultant.phone }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">å¾®ä¿¡:</span>
              <span>{{ consultant.wechat }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">è´¹ç”¨:</span>
              <span>å’¨è¯¢Â¥{{ consultant.consultationFee || 0 }} / é™ªåŒÂ¥{{ consultant.accompanyFee || 0 }}</span>
            </div>
            <div class="flex">
              <span class="text-gray-600 w-20">çŠ¶æ€:</span>
              <span :class="getStatusClass(consultant.status)">
                {{ getStatusText(consultant.status) }}
              </span>
            </div>
          </div>

          <!-- ç®€ä»‹ -->
          <div class="mb-4 p-3 bg-gray-50 rounded text-sm">
            <div class="text-gray-700 mb-2">{{ consultant.introduction }}</div>
            <div v-if="consultant.introductionKr" class="text-gray-600 text-xs">
              {{ consultant.introductionKr }}
            </div>
          </div>

          <!-- æ“ä½œæŒ‰é’® -->
          <div class="flex space-x-2">
            <button @click="editConsultant(consultant)" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
              ç¼–è¾‘
            </button>
            <button @click="deleteConsultant(consultant._id)" class="flex-1 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
              åˆ é™¤
            </button>
          </div>
        </div>
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      <div v-if="consultants.length === 0" class="text-center py-20">
        <p class="text-gray-500 text-lg mb-4">æš‚æ— é¡¾é—®æ•°æ®</p>
        <button @click="openAddDialog" class="bg-green-500 text-white px-6 py-3 rounded">æ·»åŠ ç¬¬ä¸€ä¸ªé¡¾é—®</button>
      </div>
    </div>

    <!-- ç¼–è¾‘/æ·»åŠ å¯¹è¯æ¡† -->
    <div v-if="showDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="closeDialog">
      <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto" @click.stop>
        <h2 class="text-2xl font-bold mb-6">{{ isEdit ? 'ç¼–è¾‘é¡¾é—®' : 'æ·»åŠ é¡¾é—®' }}</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div>
            <label class="block text-sm font-medium mb-1">å§“åï¼ˆä¸­æ–‡ï¼‰*</label>
            <input v-model="formData.name" class="w-full border rounded px-3 py-2" placeholder="è¯·è¾“å…¥ä¸­æ–‡å§“å">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">å§“åï¼ˆéŸ©æ–‡ï¼‰</label>
            <input v-model="formData.nameKr" class="w-full border rounded px-3 py-2" placeholder="è¯·è¾“å…¥éŸ©æ–‡å§“å">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">ç”µè¯</label>
            <input v-model="formData.phone" class="w-full border rounded px-3 py-2" placeholder="010-1234-5678">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">å¾®ä¿¡å·*</label>
            <input v-model="formData.wechat" class="w-full border rounded px-3 py-2" placeholder="å¾®ä¿¡å·">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">KakaoTalk</label>
            <input v-model="formData.kakaoTalk" class="w-full border rounded px-3 py-2" placeholder="KakaoTalk ID">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">æ€§åˆ«</label>
            <select v-model="formData.gender" class="w-full border rounded px-3 py-2">
              <option value="female">å¥³</option>
              <option value="male">ç”·</option>
              <option value="other">å…¶ä»–</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">ä»ä¸šå¹´é™</label>
            <input v-model.number="formData.experience" type="number" class="w-full border rounded px-3 py-2" placeholder="å¹´">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">è¯„åˆ†</label>
            <input v-model.number="formData.rating" type="number" step="0.1" max="5" class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">å’¨è¯¢è´¹ï¼ˆå…ƒï¼‰</label>
            <input v-model.number="formData.consultationFee" type="number" class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">é™ªåŒè´¹ï¼ˆå…ƒï¼‰</label>
            <input v-model.number="formData.accompanyFee" type="number" class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">çŠ¶æ€</label>
            <select v-model="formData.status" class="w-full border rounded px-3 py-2">
              <option value="active">åœ¨çº¿</option>
              <option value="busy">å¿™ç¢Œ</option>
              <option value="vacation">ä¼‘å‡</option>
              <option value="inactive">ç¦»çº¿</option>
            </select>
          </div>
          <div>
            <label class="flex items-center">
              <input type="checkbox" v-model="formData.featured" class="mr-2">
              <span class="text-sm font-medium">æ¨èé¡¾é—®</span>
            </label>
          </div>
        </div>

        <!-- è¯­è¨€èƒ½åŠ› -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">è¯­è¨€èƒ½åŠ›ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
          <input v-model="languagesStr" class="w-full border rounded px-3 py-2" placeholder="ä¸­æ–‡,éŸ©è¯­,è‹±è¯­">
        </div>

        <!-- ä¸“é•¿é¢†åŸŸ -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">ä¸“é•¿é¢†åŸŸï¼ˆé€—å·åˆ†éš”ï¼‰</label>
          <input v-model="specialtiesStr" class="w-full border rounded px-3 py-2" placeholder="åŒ»ç¾å’¨è¯¢,æ•´å½¢å’¨è¯¢">
        </div>

        <!-- æœåŠ¡åŒºåŸŸ -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">æœåŠ¡åŒºåŸŸï¼ˆé€—å·åˆ†éš”ï¼‰</label>
          <input v-model="serviceAreasStr" class="w-full border rounded px-3 py-2" placeholder="æ±Ÿå—åŒº,ç‘è‰åŒº">
        </div>

        <!-- æ ‡ç­¾ -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
          <input v-model="tagsStr" class="w-full border rounded px-3 py-2" placeholder="èµ„æ·±é¡¾é—®,åŒè¯­æœåŠ¡">
        </div>

        <!-- ä¸­æ–‡ç®€ä»‹ -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">ç®€ä»‹ï¼ˆä¸­æ–‡ï¼‰</label>
          <textarea v-model="formData.introduction" class="w-full border rounded px-3 py-2" rows="3"></textarea>
        </div>

        <!-- éŸ©æ–‡ç®€ä»‹ -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1">ç®€ä»‹ï¼ˆéŸ©æ–‡ï¼‰</label>
          <textarea v-model="formData.introductionKr" class="w-full border rounded px-3 py-2" rows="3"></textarea>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="mt-6 flex justify-end space-x-3">
          <button @click="closeDialog" class="px-6 py-2 border rounded hover:bg-gray-50">å–æ¶ˆ</button>
          <button @click="saveConsultant" class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@3.3.0/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.5.0/dist/axios.min.js"></script>
  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          consultants: [],
          showDialog: false,
          isEdit: false,
          formData: {
            name: '',
            nameKr: '',
            phone: '',
            wechat: '',
            kakaoTalk: '',
            avatar: '',
            gender: 'female',
            languages: [],
            specialties: [],
            experience: 0,
            serviceAreas: [],
            serviceTypes: [],
            introduction: '',
            introductionKr: '',
            rating: 5.0,
            reviewCount: 0,
            totalServices: 0,
            consultationFee: 0,
            accompanyFee: 0,
            status: 'active',
            featured: false,
            tags: []
          },
          languagesStr: '',
          specialtiesStr: '',
          serviceAreasStr: '',
          tagsStr: '',
          editingId: null
        };
      },
      mounted() {
        this.loadConsultants();
      },
      methods: {
        async loadConsultants() {
          try {
            const res = await axios.get('/api/consultants');
            if (res.data.success) {
              this.consultants = res.data.data;
            }
          } catch (error) {
            console.error('åŠ è½½é¡¾é—®åˆ—è¡¨å¤±è´¥:', error);
            alert('åŠ è½½é¡¾é—®åˆ—è¡¨å¤±è´¥');
          }
        },
        openAddDialog() {
          this.isEdit = false;
          this.resetForm();
          this.showDialog = true;
        },
        editConsultant(consultant) {
          this.isEdit = true;
          this.editingId = consultant._id;
          this.formData = { ...consultant };
          this.languagesStr = (consultant.languages || []).join(',');
          this.specialtiesStr = (consultant.specialties || []).join(',');
          this.serviceAreasStr = (consultant.serviceAreas || []).join(',');
          this.tagsStr = (consultant.tags || []).join(',');
          this.showDialog = true;
        },
        closeDialog() {
          this.showDialog = false;
          this.resetForm();
        },
        resetForm() {
          this.formData = {
            name: '',
            nameKr: '',
            phone: '',
            wechat: '',
            kakaoTalk: '',
            avatar: '',
            gender: 'female',
            languages: [],
            specialties: [],
            experience: 0,
            serviceAreas: [],
            serviceTypes: [],
            introduction: '',
            introductionKr: '',
            rating: 5.0,
            reviewCount: 0,
            totalServices: 0,
            consultationFee: 0,
            accompanyFee: 0,
            status: 'active',
            featured: false,
            tags: []
          };
          this.languagesStr = '';
          this.specialtiesStr = '';
          this.serviceAreasStr = '';
          this.tagsStr = '';
          this.editingId = null;
        },
        async saveConsultant() {
          // éªŒè¯å¿…å¡«é¡¹
          if (!this.formData.name || !this.formData.wechat) {
            alert('è¯·å¡«å†™å§“åå’Œå¾®ä¿¡å·');
            return;
          }

          // å¤„ç†æ•°ç»„å­—æ®µ
          this.formData.languages = this.languagesStr.split(',').map(s => s.trim()).filter(s => s);
          this.formData.specialties = this.specialtiesStr.split(',').map(s => s.trim()).filter(s => s);
          this.formData.serviceAreas = this.serviceAreasStr.split(',').map(s => s.trim()).filter(s => s);
          this.formData.tags = this.tagsStr.split(',').map(s => s.trim()).filter(s => s);

          try {
            let res;
            if (this.isEdit) {
              res = await axios.put(`/api/consultants/${this.editingId}`, this.formData);
            } else {
              res = await axios.post('/api/consultants', this.formData);
            }

            if (res.data.success) {
              alert(this.isEdit ? 'æ›´æ–°æˆåŠŸ' : 'æ·»åŠ æˆåŠŸ');
              this.closeDialog();
              this.loadConsultants();
            } else {
              alert(res.data.message || 'ä¿å­˜å¤±è´¥');
            }
          } catch (error) {
            console.error('ä¿å­˜é¡¾é—®å¤±è´¥:', error);
            alert('ä¿å­˜å¤±è´¥');
          }
        },
        async deleteConsultant(id) {
          if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¾é—®å—ï¼Ÿ')) {
            return;
          }

          try {
            const res = await axios.delete(`/api/consultants/${id}`);
            if (res.data.success) {
              alert('åˆ é™¤æˆåŠŸ');
              this.loadConsultants();
            } else {
              alert(res.data.message || 'åˆ é™¤å¤±è´¥');
            }
          } catch (error) {
            console.error('åˆ é™¤é¡¾é—®å¤±è´¥:', error);
            alert('åˆ é™¤å¤±è´¥');
          }
        },
        getGenderText(gender) {
          const map = { male: 'ç”·', female: 'å¥³', other: 'å…¶ä»–' };
          return map[gender] || 'æœªçŸ¥';
        },
        getStatusText(status) {
          const map = { active: 'åœ¨çº¿', busy: 'å¿™ç¢Œ', vacation: 'ä¼‘å‡', inactive: 'ç¦»çº¿' };
          return map[status] || status;
        },
        getStatusClass(status) {
          const map = {
            active: 'text-green-600',
            busy: 'text-orange-600',
            vacation: 'text-blue-600',
            inactive: 'text-gray-600'
          };
          return map[status] || 'text-gray-600';
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
